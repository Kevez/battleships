$(function(){var e,t,n,r,i,s,o,u,a,f,l;var c,h,p,d,v;var m;var g;var y;var b;var w;var E;var S;BATT.pageHelper=new BATT.PageHelper;BATT.pageHelper.initialize()});window.BATT={};BATT.PageHelper=function(){};BATT.PageHelper.prototype={initialize:function(){CURR_CPU_SHIPS=3;CURR_P1_SHIPS=3;CANVAS_EXPLOSION_WIDTH=30;CANVAS_EXPLOSION_HEIGHT=25;GRID_SIZE=10;canHit=1;cpuShipsPlaced=0;cpuHitMemory=[];killFlag=0;cpuLastSuccessfulHitX=0;cpuLastSuccessfulHitY=0;_cpuLastSuccessfulHitX=0;_cpuLastSuccessfulHitY=0;cpuTryThisDirection=1;cpuGrid=p1Grid=new Array(10);cpuShipsRemaining=CURR_CPU_SHIPS;p1ShipsRemaining=CURR_P1_SHIPS;manifest=[{src:"img/spritesheet.png",id:"sprite"},{src:"sounds/background.ogg",id:"background"},{src:"sounds/hit.ogg",id:"hit"},{src:"sounds/shipdestroyed.ogg",id:"shipdestroyed"},{src:"sounds/victory.ogg",id:"victory"},{src:"sounds/splash.ogg",id:"splash"}];preload=new createjs.LoadQueue;preload.installPlugin(createjs.Sound);preload.addEventListener("progress",this.handleProgress);preload.addEventListener("complete",this.startGame);preload.loadManifest(manifest);mainmenu=document.getElementById("main-menu");stage=new createjs.Stage(mainmenu);howToText=new createjs.Text("Morning sir,\n\nA series of enemy ships are heading our way.\nWe must destroy them at once.\nClick on a tile to fire at them.\n\nI believe in you Captain.","17px Verdana","#cceeff");howToText.x=481;howToText.y=44;howToText.textAlign="center";playbutton=new createjs.Shape;playbutton.graphics.beginFill("#cceeff").drawRect(25,25,200,50);playbutton.x=356;playbutton.y=168;buttonText=new createjs.Text("Click to Play!","22px Verdana","#222");buttonText.x=411;buttonText.y=204;stage.addChild(howToText,playbutton,buttonText);stage.update();BATT.pageHelper.updateText("#cpu-brain","CPU is waiting");BATT.pageHelper.updateText("#p1-feedback","Your turn")},handleProgress:function(e){var t=Math.ceil(preload.progress*100);if(t<18){$("#preloader").text("Grabbing uniform ("+t+"%)")}else if(t<35){$("#preloader").text("Quick snack ("+t+"%)")}else if(t<70){$("#preloader").text("Readying missiles ("+t+"%)")}else if(t<100){$("#preloader").text("All systems go ("+t+"%)")}},removeMainMenu:function(e){$(e).animate({left:"-1000px",opacity:.8},1e3,function(){})},returnMainMenu:function(e,t){$(e).animate({left:"0px",opacity:1},1e3,function(){});mainmenu=document.getElementById("main-menu");stage=new createjs.Stage(mainmenu);t=new createjs.Text(t,"22px Verdana","#cceeff");t.x=481;t.y=44;t.textAlign="center";stage.addChild(t);stage.update()},startGame:function(){$("#wrap").fadeIn(250);$("#preloader").hide();BATT.pageHelper.playSound("background");cpuShipData=[],p1ShipData=[];BATT.pageHelper.createGrid("#cpu",cpuGrid);BATT.pageHelper.createGrid("#p1",p1Grid);BATT.pageHelper.proposeShip(cpuShipData.length,"cpu");BATT.pageHelper.proposeShip(p1ShipData.length,"p1");BATT.pageHelper.deployShips("#cpu",cpuShipData,0);BATT.pageHelper.deployShips("#p1",p1ShipData,1);$("canvas#main-menu").click(function(){BATT.pageHelper.removeMainMenu(this)});$("#cpu .tile").click(function(){BATT.pageHelper.processHits(this)})},proposeShip:function(e,t){initCoordX=BATT.pageHelper.getRandomNum(0,GRID_SIZE-1);initCoordY=BATT.pageHelper.getRandomNum(0,GRID_SIZE-1);possibleDirections=[];if(initCoordX-5>=-1){possibleDirections.push("N")}else{possibleDirections.push("S")}if(initCoordY-5>=-1){possibleDirections.push("W")}else{possibleDirections.push("E")}key=BATT.pageHelper.getRandomNum(0,possibleDirections.length);proposedShip=[];if(e==0){switch(possibleDirections[key]){case"N":proposedShip.push([initCoordX,initCoordY],[initCoordX-1,initCoordY],[initCoordX-2,initCoordY],[initCoordX-3,initCoordY],[initCoordX-4,initCoordY]);break;case"S":proposedShip.push([initCoordX,initCoordY],[initCoordX+1,initCoordY],[initCoordX+2,initCoordY],[initCoordX+3,initCoordY],[initCoordX+4,initCoordY]);break;case"E":proposedShip.push([initCoordX,initCoordY],[initCoordX,initCoordY+1],[initCoordX,initCoordY+2],[initCoordX,initCoordY+3],[initCoordX,initCoordY+4]);break;case"W":proposedShip.push([initCoordX,initCoordY],[initCoordX,initCoordY-1],[initCoordX,initCoordY-2],[initCoordX,initCoordY-3],[initCoordX,initCoordY-4]);break}}else{switch(possibleDirections[key]){case"N":proposedShip.push([initCoordX,initCoordY],[initCoordX-1,initCoordY],[initCoordX-2,initCoordY],[initCoordX-3,initCoordY]);break;case"S":proposedShip.push([initCoordX,initCoordY],[initCoordX+1,initCoordY],[initCoordX+2,initCoordY],[initCoordX+3,initCoordY]);break;case"E":proposedShip.push([initCoordX,initCoordY],[initCoordX,initCoordY+1],[initCoordX,initCoordY+2],[initCoordX,initCoordY+3]);break;case"W":proposedShip.push([initCoordX,initCoordY],[initCoordX,initCoordY-1],[initCoordX,initCoordY-2],[initCoordX,initCoordY-3]);break}}t=="cpu"?BATT.pageHelper.checkForOverlap(proposedShip,cpuShipData,"cpu"):BATT.pageHelper.checkForOverlap(proposedShip,p1ShipData,"p1")},checkForOverlap:function(e,t,n){overlap=false;for(var r=0;r<t.length;r++){for(var i=0;i<t[r].length;i++){for(var s=0;s<e.length;s++){if(e[s][0]==t[r][i][0]&&e[s][1]==t[r][i][1]){overlap=true}}}}if(overlap==true){BATT.pageHelper.proposeShip(t.length,n)}else{t.push(e);if(t.length<3){BATT.pageHelper.proposeShip(t.length,n)}}},createGrid:function(e,t){for(var n=0;n<10;n++){t[n]=new Array(10);for(var r=0;r<10;r++){$(e).append("<div id='"+e.substring(1)+""+n+"-"+r+"' class='tile'></div>")}}},deployShips:function(e,t,n){for(var r=0;r<t.length;r++){for(var i=0;i<t[r].length;i++){$(e+t[r][i][0]+"-"+t[r][i][1]).addClass("shipPart"+n);if(i==0){$(e+t[r][i][0]+"-"+t[r][i][1]).append("<div class='light'></div>")}}}},processHits:function(e){coords=$(e).attr("id").substring(3).split("-");coordX=coords[0];coordY=coords[1];if(canHit==0){BATT.pageHelper.updateText("#p1-feedback","Please wait for the CPU")}else if(BATT.pageHelper.checkIfAlreadyHit("#cpu",coordX,coordY)==true){BATT.pageHelper.updateText("#p1-feedback","Already hit here!")}else{canHit=0;BATT.pageHelper.checkHit(coordX,coordY,cpuShipData,"#cpu",cpuShipsRemaining,"#p1-feedback");BATT.pageHelper.updateText("#cpu-brain","Hmmm");var t=setTimeout(function(){cpuCoordX=BATT.pageHelper.getRandomNum(0,GRID_SIZE-1);cpuCoordY=BATT.pageHelper.getRandomNum(0,GRID_SIZE-1);while(BATT.pageHelper.checkIfAlreadyHit("#p1",cpuCoordX,cpuCoordY)==true){cpuCoordX=BATT.pageHelper.getRandomNum(0,GRID_SIZE-1);cpuCoordY=BATT.pageHelper.getRandomNum(0,GRID_SIZE-1)}if(killFlag==1){if(cpuTryThisDirection==1){_cpuLastSuccessfulHitY=cpuLastSuccessfulHitY-1;_cpuLastSuccessfulHitX=cpuLastSuccessfulHitX;if($("#p1"+_cpuLastSuccessfulHitX+"-"+_cpuLastSuccessfulHitY).hasClass("destroyed")==true){_cpuLastSuccessfulHitY--}else if($("#p1"+_cpuLastSuccessfulHitX+"-"+_cpuLastSuccessfulHitY).hasClass("missed")==true){cpuTryThisDirection=3}}else if(cpuTryThisDirection==2){_cpuLastSuccessfulHitX=cpuLastSuccessfulHitX-1;_cpuLastSuccessfulHitY=cpuLastSuccessfulHitY;if($("#p1"+_cpuLastSuccessfulHitX+"-"+_cpuLastSuccessfulHitY).hasClass("destroyed")==true){_cpuLastSuccessfulHitX--}else if($("#p1"+_cpuLastSuccessfulHitX+"-"+_cpuLastSuccessfulHitY).hasClass("missed")==true){cpuTryThisDirection=4}}else if(cpuTryThisDirection==3){_cpuLastSuccessfulHitY=cpuLastSuccessfulHitY+1;_cpuLastSuccessfulHitX=cpuLastSuccessfulHitX;if($("#p1"+_cpuLastSuccessfulHitX+"-"+_cpuLastSuccessfulHitY).hasClass("destroyed")==true){_cpuLastSuccessfulHitY++}else if($("#p1"+_cpuLastSuccessfulHitX+"-"+_cpuLastSuccessfulHitY).hasClass("missed")==true){cpuTryThisDirection=1}}else{_cpuLastSuccessfulHitX=cpuLastSuccessfulHitX+1;_cpuLastSuccessfulHitY=cpuLastSuccessfulHitY;if($("#p1"+_cpuLastSuccessfulHitX+"-"+_cpuLastSuccessfulHitY).hasClass("destroyed")==true){_cpuLastSuccessfulHitX++}else if($("#p1"+_cpuLastSuccessfulHitX+"-"+_cpuLastSuccessfulHitY).hasClass("missed")==true){cpuTryThisDirection=2}}cpuCoordX=_cpuLastSuccessfulHitX;cpuCoordY=_cpuLastSuccessfulHitY}BATT.pageHelper.checkHit(cpuCoordX,cpuCoordY,p1ShipData,"#p1",p1ShipsRemaining,"#cpu-brain");cpuHitMemory.push([cpuCoordX,cpuCoordY]);canHit=1;BATT.pageHelper.updateText("#cpu-brain","* Waiting for you *");BATT.pageHelper.updateText("#p1-feedback","Your turn");$("#wrap").removeClass("chaos")},1750)}},checkHit:function(e,t,n,r,i,s){successfulHit=false;for(var o=0;o<n.length;o++){for(var u=0;u<n[o].length;u++){if(e==n[o][u][0]&&t==n[o][u][1]){BATT.pageHelper.playSound("hit");BATT.pageHelper.explosion(r,e,t);BATT.pageHelper.updateText(s,"Nice shot!");$(r+e+"-"+t).addClass("destroyed destroyed"+o);if(r=="#p1"){killFlag=1;cpuLastSuccessfulHitX=e;cpuLastSuccessfulHitY=t}if(BATT.pageHelper.numberOfPartsDestroyed(r,o)==n[o].length){BATT.pageHelper.playSound("shipdestroyed");i--;BATT.pageHelper.updateText(r+"board span",i);$("#wrap").addClass("chaos");BATT.pageHelper.isVictorius(i,r);r=="#cpu"?cpuShipsRemaining=i:p1ShipsRemaining=i;if(r=="#p1"&&killFlag==1){killFlag=0}}successfulHit=true}}}if(successfulHit!==true){BATT.pageHelper.playSound("splash");BATT.pageHelper.updateText(r+e+"-"+t,"<div class='splash'></div>");BATT.pageHelper.updateText(s,"Awkward.");$(r+e+"-"+t).addClass("missed");if(r=="#p1"&&killFlag==1){cpuTryThisDirection+=1;if(cpuTryThisDirection>4){cpuTryThisDirection=1}}}},checkIfAlreadyHit:function(e,t,n){return $(e+""+t+"-"+n).is(".destroyed, .missed")},numberOfPartsDestroyed:function(e,t){return $(e+" .destroyed"+t).size()},explosion:function(e,t,n){var r;var i;var s;$(e+""+t+"-"+n).html("<canvas id='canvas"+t+"-"+n+"' width='"+CANVAS_EXPLOSION_WIDTH+"' height='"+CANVAS_EXPLOSION_HEIGHT+"'></canvas>");r=document.getElementById("canvas"+t+"-"+n);i=new createjs.Stage(r);var o=new createjs.SpriteSheet({images:["img/spritesheet.png"],frames:{width:32,height:32,regX:16,regY:16},animations:{walk:[0,24,"walk"]}});s=new createjs.BitmapAnimation(o);s.gotoAndPlay("walk");s.vX=10;s.x=13;s.y=10;i.addChild(s);createjs.Ticker.addListener(i);createjs.Ticker.setFPS(60)},playSound:function(e){createjs.Sound.play(e,createjs.Sound.INTERRUPT_ANY,0,0,0,1)},updateText:function(e,t){$(e).html(t)},isVictorius:function(e,t){if(e===0){if(t=="#cpu"){BATT.pageHelper.playSound("victory");BATT.pageHelper.returnMainMenu("canvas#main-menu","Great work sir!")}else{BATT.pageHelper.returnMainMenu("canvas#main-menu","Better luck next time...")}var n=setTimeout(function(){location.reload()},3e3)}},getRandomNum:function(e,t){return Math.floor(Math.random()*t)+e}}